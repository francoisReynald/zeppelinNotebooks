{"paragraphs":[{"text":"%md\n# About\n**Objective:** Become familiar with using Spark.ML to cluster using GMMs\n**File locations:** spark-labs/pollution_us_2000_2016.csv\n**Successful outcome:** You will have clustered cities based on their pollution using GMMs\n**Before you begin:**\n**Related lessons:** Clustering, Gaussian Mixture Model\n\n---","user":"admin","dateUpdated":"2019-03-29T17:57:01+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565453_-1956627754","id":"20171105-200834_1116095891","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:01+0000","dateFinished":"2019-03-29T17:57:01+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:128178"},{"text":"%md\n# Setup\n---","user":"admin","dateUpdated":"2019-03-29T17:57:01+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565455_-939354274","id":"20181114-164229_902436001","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:01+0000","dateFinished":"2019-03-29T17:57:01+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128179"},{"title":"Retrieve the pollution dataset","text":"%sh\n\nrm -f /home/zeppelin/uspollution.zip\nwget -P /home/zeppelin https://s3-us-west-1.amazonaws.com/sci-241/us-pollution-2000-2016/uspollution.zip\nunzip -q -o /home/zeppelin/uspollution.zip\nhdfs dfs -rm spark-labs/pollution_us_2000_2016.csv\nhdfs dfs -put /home/zeppelin//pollution_us_2000_2016.csv spark-labs/","user":"admin","dateUpdated":"2019-04-10T08:02:37+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1554883116637_1680651941","id":"20190410-075836_2141986177","dateCreated":"2019-04-10T07:58:36+0000","dateStarted":"2019-04-10T08:02:37+0000","dateFinished":"2019-04-10T08:02:50+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128180"},{"title":"Import libraries","text":"%pyspark\n\nfrom pyspark.ml.feature import VectorAssembler\nfrom pyspark.ml.clustering import GaussianMixture\nfrom pyspark.ml.evaluation import ClusteringEvaluator","user":"admin","dateUpdated":"2019-04-10T08:15:08+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565456_678806854","id":"20181114-164621_138379904","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:02+0000","dateFinished":"2019-03-29T17:57:37+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128181"},{"text":"%md\n# Lab\n---","user":"admin","dateUpdated":"2019-03-29T17:57:37+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565457_1740626732","id":"20181114-164844_1661453681","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:37+0000","dateFinished":"2019-03-29T17:57:37+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128182"},{"text":"%md\n## Load and inspect the data","user":"admin","dateUpdated":"2019-03-29T17:57:37+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565458_-987545624","id":"20181120-105601_996869670","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:37+0000","dateFinished":"2019-03-29T17:57:37+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128183"},{"text":"%md\nFirst we need to load the data into a dataframe using the 'header' and 'inferSchema' options.","user":"admin","dateUpdated":"2019-03-29T17:57:37+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565458_-2139102202","id":"20181120-104302_1071736728","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:37+0000","dateFinished":"2019-03-29T17:57:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128184"},{"title":"1 - Load the data into a Spark DataFrame","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:38+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565459_56997354","id":"20171105-200623_656362182","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128185"},{"text":"%md\nWhen doing machine learning, it is important to look at the data you are working with\nUse z.show(data) to view the first 20 rows of your data","user":"admin","dateUpdated":"2019-03-29T17:57:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565459_-827701816","id":"20171105-201923_413365117","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:38+0000","dateFinished":"2019-03-29T17:57:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128186"},{"title":"2 - Inspect the data","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:38+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565459_2137375038","id":"20171105-201709_849284875","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128187"},{"text":"%md\nThis data contains many readings per day for each city for 16 years.\nTo get a single instance for each city, based off the average pollution, type the following\n~~~\ngrouped = data.groupby(['City','State']).mean()\n~~~","user":"admin","dateUpdated":"2019-03-29T17:57:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565459_450709936","id":"20181126-084317_898717385","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:38+0000","dateFinished":"2019-03-29T17:57:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128188"},{"title":"3 - Group the data","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:38+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565460_-215830186","id":"20181126-084340_673991449","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128189"},{"text":"%md\n## Transform the DataFrame into one usable by Spark ML\n\nAll our data in this lab is numerical, so we just need to turn it in to feature vectors.\nTo remove any rows that are missing data, type\n~~~\ndata = grouped.na.drop(how='any')\n~~~\n","user":"admin","dateUpdated":"2019-03-29T17:57:39+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565460_-1536097473","id":"20171105-201449_1118165660","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:39+0000","dateFinished":"2019-03-29T17:57:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128190"},{"title":"4 - Remove rows with missing data","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:39+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565460_-26929878","id":"20181126-084936_1414866705","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128191"},{"text":"%md\nNext, use the VectorAssembler to transform the columns into a vector \n\n~~~\nfeatures = ['avg(NO2 Mean)', 'avg(NO2 1st Max Value)','avg(NO2 1st Max Hour)','avg(O3 Mean)', 'avg(O3 1st Max Value)','avg(O3 1st Max Hour)','avg(SO2 Mean)', 'avg(SO2 1st Max Value)','avg(SO2 1st Max Hour)','avg(CO Mean)', 'avg(CO 1st Max Value)','avg(CO 1st Max Hour)' ]\nassembler = VectorAssembler(inputCols=features, outputCol=\"features\")\nvectorized = assembler.transform(grouped).cache()\n~~~","user":"admin","dateUpdated":"2019-03-29T17:57:39+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565460_-553315258","id":"20181120-105834_455616424","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:39+0000","dateFinished":"2019-03-29T17:57:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128192"},{"title":"5 - Create the 'features' vector","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565461_2078269661","id":"20181120-105833_534068450","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128193"},{"title":"6 - Show the 'features' vector","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"label":"string","features":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565461_1055493498","id":"20181121-103142_733725590","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128194"},{"text":"%md\nThis is the data that we will feed to our machine learning algorithm.","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565461_1064539356","id":"20181120-114756_1372220167","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:40+0000","dateFinished":"2019-03-29T17:57:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128195"},{"text":"%md\n## Train a model","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565461_-1277947135","id":"20181120-142217_940991033","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:40+0000","dateFinished":"2019-03-29T17:57:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128196"},{"title":"7 - Make a GaussianMixture object to cluster the data into two classes","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565462_1576558578","id":"20181120-142341_921909094","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128197"},{"text":"%md\nRun the clustering algorithm to assign each row to a cluster\n~~~\npredictions = clusterer.fit(vectorized).transform(vectorized)\n~~~","user":"admin","dateUpdated":"2019-03-29T17:57:40+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565462_2020307914","id":"20181126-090548_1882199816","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:40+0000","dateFinished":"2019-03-29T17:57:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128198"},{"title":"8 - Cluster the data","text":"","user":"admin","dateUpdated":"2019-03-29T17:57:41+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565463_464422990","id":"20181120-145510_996717762","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128199"},{"text":"%md\nNext we will use a built in evaluator for clustering called Silhouette.\nMore about Silhouette can be found [here] (https://en.wikipedia.org/wiki/Silhouette_(clustering))\n\n~~~\nevaluator = ClusteringEvaluator()\nsilhouette = evaluator.evaluate(predictions)\nprint(\"Silhouette with squared euclidean distance = \", silhouette)\n~~~","user":"admin","dateUpdated":"2019-04-10T08:12:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1554883949499_-348393302","id":"20190410-081229_1488616165","dateCreated":"2019-04-10T08:12:29+0000","dateStarted":"2019-04-10T08:12:36+0000","dateFinished":"2019-04-10T08:12:36+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128200"},{"title":"9 - Evaluate clustering by computing the Silhouette score","text":"","user":"admin","dateUpdated":"2019-04-10T08:13:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1554883985702_-1995613904","id":"20190410-081305_1696979495","dateCreated":"2019-04-10T08:13:05+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128201"},{"text":"%md\n\nWe can use Zeppelin's built in features to visualize our clusters.\n\nTry different combinations for the xAxis and yAxis, while leaving the group as prediction\nWhich one separates the data the easiest? \n\n","user":"admin","dateUpdated":"2019-03-29T17:57:41+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565464_-1174734012","id":"20181120-154217_542387411","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:41+0000","dateFinished":"2019-03-29T17:57:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128202"},{"title":"10 - Visualize the clusters","text":"","user":"admin","dateUpdated":"2019-04-10T08:12:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Date":"string","Location":"string","MinTemp":"string","MaxTemp":"string","Rainfall":"string","Evaporation":"string","Sunshine":"string","WindGustSpeed":"string","WindSpeed9am":"string","WindSpeed3pm":"string","Humidity9am":"string","Humidity3pm":"string","Pressure9am":"string","Pressure3pm":"string","Cloud9am":"string","Cloud3pm":"string","Temp9am":"string","Temp3pm":"string","RainToday":"string","RISK_MM":"string","RainTomorrow":"string","WindGustDir_indexed":"string","WindDir9am_indexed":"string","WindDir3pm_indexed":"string","features":"string","label":"string","group":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"scatterChart":{"xAxis":{"name":"Humidity9am","index":10,"aggr":"sum"},"group":{"name":"prediction","index":26,"aggr":"sum"},"yAxis":{"name":"WindGustSpeed","index":7,"aggr":"sum"}},"pieChart":{}},"keys":[{"name":"Humidity9am","index":10,"aggr":"sum"}],"groups":[{"name":"WindGustSpeed","index":7,"aggr":"sum"}],"values":[{"name":"prediction","index":26,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565464_1201962374","id":"20181121-112847_1076813012","dateCreated":"2019-01-25T10:29:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128203"},{"text":"%md\n# Result\n**You have now:** You have now successfully clustered cities based on their pollution levels using Gaussian Mixture Models.\n\n---","user":"admin","dateUpdated":"2019-03-29T17:57:41+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565465_-472184533","id":"20181119-142716_792318228","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:41+0000","dateFinished":"2019-03-29T17:57:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128204"},{"text":"%md\n# Solution\n---","user":"admin","dateUpdated":"2019-03-29T17:57:41+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565466_-2036827594","id":"20171113-155535_1769142099","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:41+0000","dateFinished":"2019-03-29T17:57:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128205"},{"title":"1 - Load the data into a Spark DataFrame","text":"%pyspark\n\ndata = spark.read.format('csv').option('header',True).option('inferSchema',True).load('spark-labs/pollution_us_2000_2016.csv')","user":"admin","dateUpdated":"2019-03-29T17:57:41+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565466_191437388","id":"20181120-104552_1855149124","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:57:41+0000","dateFinished":"2019-03-29T17:58:11+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128206"},{"title":"2 - Inspect the data","text":"%pyspark\n\nz.show(data)","user":"admin","dateUpdated":"2019-03-29T17:58:11+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"_c0":"string","State Code":"string","County Code":"string","Site Num":"string","Address":"string","State":"string","County":"string","City":"string","Date Local":"string","NO2 Units":"string","NO2 Mean":"string","NO2 1st Max Value":"string","NO2 1st Max Hour":"string","NO2 AQI":"string","O3 Units":"string","O3 Mean":"string","O3 1st Max Value":"string","O3 1st Max Hour":"string","O3 AQI":"string","SO2 Units":"string","SO2 Mean":"string","SO2 1st Max Value":"string","SO2 1st Max Hour":"string","SO2 AQI":"string","CO Units":"string","CO Mean":"string","CO 1st Max Value":"string","CO 1st Max Hour":"string","CO AQI":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565467_-24695503","id":"20181120-104909_658872","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:58:11+0000","dateFinished":"2019-03-29T17:58:12+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128207"},{"title":"3 - Group the data","text":"%pyspark\n\ngrouped = data.groupby(['City','State']).mean()","user":"admin","dateUpdated":"2019-03-29T17:58:12+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565474_-1286015013","id":"20181126-084441_1373405303","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:58:12+0000","dateFinished":"2019-03-29T17:58:13+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128208"},{"title":"4 - Remove rows with missing data","text":"%pyspark\n\ndata = grouped.na.drop(how='any')","user":"admin","dateUpdated":"2019-03-29T17:58:13+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565475_1094968052","id":"20181126-085032_832847349","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:58:13+0000","dateFinished":"2019-03-29T17:58:13+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128209"},{"title":"5 - Create the 'features' vector","text":"%pyspark\n\nfeatures = ['avg(NO2 Mean)', 'avg(NO2 1st Max Value)','avg(NO2 1st Max Hour)','avg(O3 Mean)', 'avg(O3 1st Max Value)','avg(O3 1st Max Hour)','avg(SO2 Mean)', 'avg(SO2 1st Max Value)','avg(SO2 1st Max Hour)','avg(CO Mean)', 'avg(CO 1st Max Value)','avg(CO 1st Max Hour)' ]\nassembler = VectorAssembler(inputCols=features, outputCol=\"features\")\nvectorized = assembler.transform(grouped).cache()","user":"admin","dateUpdated":"2019-03-29T17:58:13+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565475_-1175764637","id":"20181126-085517_495788492","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:58:13+0000","dateFinished":"2019-03-29T17:58:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128210"},{"title":"6 - Show the 'features' vector","text":"%pyspark\n\nz.show(vectorized.select('features'))","user":"admin","dateUpdated":"2019-03-29T17:58:40+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"features":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565475_-1070591012","id":"20181121-102959_839674579","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:58:40+0000","dateFinished":"2019-03-29T17:59:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128211"},{"title":"7 - Make a GaussianMixture object to cluster the data into two classes","text":"%pyspark\n\nclusterer =  GaussianMixture(k=2)","user":"admin","dateUpdated":"2019-03-29T17:59:20+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565476_-329382909","id":"20181126-090312_1225943434","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:59:20+0000","dateFinished":"2019-03-29T17:59:20+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128212"},{"title":"8 - Cluster the data","text":"%pyspark\n\npredictions = clusterer.fit(vectorized).transform(vectorized)","user":"admin","dateUpdated":"2019-03-29T17:59:32+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565476_797853015","id":"20181126-090724_1920895284","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T17:59:32+0000","dateFinished":"2019-03-29T18:00:04+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128213"},{"title":"9 - Evaluate clustering by computing the Silhouette score","text":"%pyspark\n\nevaluator = ClusteringEvaluator()\nsilhouette = evaluator.evaluate(predictions)\nprint(\"Silhouette with squared euclidean distance = \", silhouette)","user":"admin","dateUpdated":"2019-04-10T08:18:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-1-200.eu-central-1.compute.internal:4040/jobs/job?id=974","http://ip-172-31-1-200.eu-central-1.compute.internal:4040/jobs/job?id=975","http://ip-172-31-1-200.eu-central-1.compute.internal:4040/jobs/job?id=976"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1554884011154_568765645","id":"20190410-081331_880684240","dateCreated":"2019-04-10T08:13:31+0000","dateStarted":"2019-04-10T08:18:43+0000","dateFinished":"2019-04-10T08:18:44+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128214"},{"title":"10 - Visualize the clusters","text":"%pyspark\n\nz.show(predictions)","user":"admin","dateUpdated":"2019-04-10T08:13:46+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Date":"string","Location":"string","MinTemp":"string","MaxTemp":"string","Rainfall":"string","Evaporation":"string","Sunshine":"string","WindGustSpeed":"string","WindSpeed9am":"string","WindSpeed3pm":"string","Humidity9am":"string","Humidity3pm":"string","Pressure9am":"string","Pressure3pm":"string","Cloud9am":"string","Cloud3pm":"string","Temp9am":"string","Temp3pm":"string","RainToday":"string","RISK_MM":"string","RainTomorrow":"string","WindGustDir_indexed":"string","WindDir9am_indexed":"string","WindDir3pm_indexed":"string","features":"string","label":"string","group":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"scatterChart":{"xAxis":{"name":"avg(O3 AQI)","index":13,"aggr":"sum"},"group":{"name":"prediction","index":23,"aggr":"sum"},"yAxis":{"name":"avg(CO AQI)","index":21,"aggr":"sum"}},"pieChart":{}},"keys":[{"name":"Humidity9am","index":10,"aggr":"sum"}],"groups":[{"name":"WindGustSpeed","index":7,"aggr":"sum"}],"values":[{"name":"prediction","index":26,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565477_568443352","id":"20181120-155137_1636863754","dateCreated":"2019-01-25T10:29:25+0000","dateStarted":"2019-03-29T18:00:22+0000","dateFinished":"2019-03-29T18:00:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128215"},{"title":"Additional resources","text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Hortonworks Apache Spark Tutorials](http://hortonworks.com/tutorials/#tuts-developers) are your natural next step where you can explore Spark in more depth.\n2. [Hortonworks Community Connection (HCC)](https://community.hortonworks.com/spaces/85/data-science.html?type=question) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Hortonworks Apache Spark Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/spark-overview/content/analyzing_data_with_apache_spark.html) - official Spark documentation.\n4. [Hortonworks Apache Zeppelin Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/zeppelin-overview/content/overview.html) - official Zeppelin documentation.","user":"admin","dateUpdated":"2019-01-25T10:29:25+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":10,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565478_-1068404373","id":"20181116-135131_93712280","dateCreated":"2019-01-25T10:29:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128216"},{"text":"%angular\n</br>\n<center>\n<a href=\"https://learn.hortonworks.com/\">\n  <img src=\"https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Ftbroas_hortonworks_c_bsns5k%2Fpublic%2Flogo-training-1.1494860458677.png\" alt=\"Hortonworks University\" style=\"width:125px;height:125px;border:0;\" align=\"middle\">\n</a>\n</center>","user":"admin","dateUpdated":"2019-01-25T10:29:25+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":2,"editorMode":"ace/mode/undefined","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565478_-2014394738","id":"20181115-083751_61749794","dateCreated":"2019-01-25T10:29:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128217"},{"text":"%angular\n","user":"admin","dateUpdated":"2019-01-25T10:29:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548408565478_1016759024","id":"20181120-161222_1016896442","dateCreated":"2019-01-25T10:29:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128218"}],"name":"Labs/GaussianMixtureModel","id":"2E4S3KDEF","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"python:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}